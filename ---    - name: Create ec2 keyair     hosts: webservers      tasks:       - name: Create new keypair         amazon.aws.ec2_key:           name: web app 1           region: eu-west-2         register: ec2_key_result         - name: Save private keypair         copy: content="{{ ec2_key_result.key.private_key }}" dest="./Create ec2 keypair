---

  - name: Create ec2 keypair
    hosts: webservers

    tasks:
      - name: Create new keypair
        amazon.aws.ec2_key:
          name: web app 1
          region: eu-west-2
        register: ec2_key_result


      - name: Save private keypair
        copy: content="{{ ec2_key_result.key.private_key }}" dest="./aws.webapp1.pem" mode=600
        when: ec2_key_result.changed
